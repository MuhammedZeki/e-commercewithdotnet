@model Card

@section Bar {
    <section class="py-3 shadow-sm" style="background: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%); border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="/" class="text-decoration-none d-inline-flex align-items-center breadcrumb-link">
                            <i class="fa-solid fa-house me-2"></i>Anasayfa
                        </a>
                    </li>
                    <li class="breadcrumb-item active d-inline-flex align-items-center" aria-current="page">
                        Alışveriş Sepeti
                    </li>
                </ol>
            </nav>
        </div>
    </section>
}

<section class="mt-4 mb-5">
    <div class="container">
        <div class="d-flex align-items-center mb-4">
            <div style="width: 5px; height: 25px; background: #fbc531; border-radius: 10px;" class="me-3"></div>
            <h3 class="fw-bold text-dark mb-0">Sepetim</h3>
            @if (Model.CardItems.Count > 0)
            {
                <span class="badge bg-primary ms-3 rounded-pill" style="background: #1a1a2e !important;">@Model.CardItems.Count Ürün</span>
            }
        </div>

        @if (Model.CardItems.Count == 0)
        {
            <div class="text-center py-5 shadow-sm bg-white" style="border-radius: 20px;">
                <div class="mb-3">
                    <i class="fa-solid fa-cart-shopping text-muted opacity-25" style="font-size: 4rem;"></i>
                </div>
                <h5 class="text-secondary">Sepetiniz şu an boş.</h5>
                <p class="text-muted small">Alışverişe devam edip harika ürünler keşfedebilirsiniz!</p>
                <a href="/" class="btn btn-primary rounded-pill px-4 mt-2" style="background: #1a1a2e; border: none;">Alışverişe Başla</a>
            </div>
        }
        else
        {
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm" style="border-radius: 20px; overflow: hidden;">
                        <ul class="list-group list-group-flush">
                            @foreach (var item in Model.CardItems)
                            {
                                <li class="p-4 list-group-item border-bottom-0 shadow-sm mb-2 bg-white">
                                    <div class="row align-items-center">
                                        <div class="col-3 col-md-2">
                                            <img src="~/img/@item.Product.Img" class="img-fluid rounded-3" style="max-height: 80px; object-fit: contain;" alt="@item.Product.Name">
                                        </div>
                                        
                                        <div class="col-5 col-md-5">
                                            <a class="text-decoration-none text-dark fw-bold mb-0 d-block text-truncate" asp-controller="Product" asp-action="Detail" asp-route-id="@item.Product.Id">
                                                @item.Product.Name
                                            </a>
                                            <small class="text-muted">Birim Fiyat: @item.Product.Price.ToString("C2")</small>
                                        </div>

                                        <div class="col-4 col-md-3">
                                            <div class="d-flex align-items-center justify-content-center bg-light rounded-pill p-1">
                                                <form asp-controller="Cart" asp-action="Decrease" method="post" class="m-0">
                                                    <input type="hidden" name="cartItemId" value="@item.Id" />
                                                    <button type="submit" class="btn btn-sm btn-white rounded-circle shadow-sm" style="width: 28px; height: 28px;">−</button>
                                                </form>

                                                <span class="mx-3 fw-bold text-dark">@item.Quantity</span>

                                                <form asp-controller="Cart" asp-action="Increase" method="post" class="m-0">
                                                    <input type="hidden" name="cartItemId" value="@item.Id" />
                                                    <button type="submit" class="btn btn-sm btn-white rounded-circle shadow-sm" style="width: 28px; height: 28px;">+</button>
                                                </form>
                                            </div>
                                        </div>

                                        <div class="col-12 col-md-2 text-end mt-3 mt-md-0">
                                            <div class="d-flex flex-md-column align-items-center justify-content-between">
                                                <span class="fw-bolder text-primary mb-md-2">@((item.Product.Price * item.Quantity).ToString("N2")) ₺</span>
                                                <form asp-controller="Cart" asp-action="Remove" method="post">
                                                    <input type="hidden" name="cartItemId" value="@item.Id">
                                                    <button type="submit" class="btn btn-outline-danger btn-sm border-0 rounded-circle">
                                                        <i class="fa-solid fa-trash-can"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card border-0 shadow p-3" style="border-radius: 25px; background: #fff; position: sticky; top: 20px;">
                        <div class="card-body">
                            <h5 class="fw-bold mb-4 d-flex align-items-center">
                                <i class="fa-solid fa-receipt me-2 text-primary"></i> Sipariş Özeti
                            </h5>
                            
                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Ara Toplam</span>
                                <span class="fw-bold">@Model.SubTotal().ToString("N2") ₺</span>
                            </div>
                            
                            <div class="d-flex justify-content-between mb-3 text-success">
                                <span>Kargo Ücreti</span>
                                <span class="fw-bold">Ücretsiz</span>
                            </div>

                            <div class="d-flex justify-content-between mb-3">
                                <span class="text-muted">Vergi (%20)</span>
                                <span class="fw-bold">@((Model.SubTotal() * 0.2).ToString("N2")) ₺</span>
                            </div>

                            <hr class="my-4 opacity-10">

                            <div class="d-flex justify-content-between mb-4">
                                <span class="h5 fw-bold">Genel Toplam</span>
                                <span class="h5 fw-bolder text-primary">@Model.TotalPrice().ToString("N2") ₺</span>
                            </div>

                            <div class="d-grid">
                                <a asp-controller="Order" asp-action="CheckOut" class="btn btn-primary btn-lg shadow" style="border-radius: 15px; background: #1a1a2e; border: none;">
                                    Siparişi Tamamla <i class="fa-solid fa-chevron-right ms-2 small"></i>
                                </a>
                            </div>

                            <div class="mt-4 text-center">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" height="20" class="me-2 grayscale opacity-50" alt="">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" height="15" class="me-2 grayscale opacity-50" alt="">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" height="20" class="grayscale opacity-50" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<style>
    .breadcrumb-link { color: rgba(255, 255, 255, 0.6) !important; transition: 0.3s; font-size: 0.9rem; }
    .breadcrumb-link:hover { color: #fff !important; }
    .breadcrumb-item.active { color: #fbc531 !important; font-weight: 600; font-size: 0.9rem; }
    .breadcrumb-item + .breadcrumb-item::before { color: rgba(255, 255, 255, 0.3) !important; content: "\f105"; font-family: "Font Awesome 6 Free"; font-weight: 900; }
    .btn-white { background: #fff; border: 1px solid #dee2e6; color: #1a1a2e; transition: 0.2s; }
    .btn-white:hover { background: #1a1a2e; color: #fff; border-color: #1a1a2e; }
    .grayscale { filter: grayscale(100%); }
</style>